{% extends 'base.html' %}
{% load static %}

{% block title %}Smart Device Manager - Confirm Delete{% endblock %}

{% block page_title %}Delete Device{% endblock %}

{% block page_subtitle %}Permanently remove a smart device{% endblock %}

{% block content %}
<div class="w-full flex justify-center p-4">
    <div class="glass modal-content rounded-2xl border border-white/20 dark:border-gray-700/50 shadow-2xl w-full max-w-xl transform transition-all duration-300">
        <div class="sticky top-0 bg-gradient-to-r from-red-600/10 to-orange-600/10 dark:from-red-500/10 dark:to-orange-500/10 p-6 border-b border-white/20 dark:border-gray-700/50 backdrop-blur-sm">
            <div class="flex items-center space-x-3">
                <div class="w-12 h-12 bg-gradient-to-br from-red-600 to-orange-600 rounded-xl flex items-center justify-center">
                    <i class="fas fa-trash-alt text-white text-lg"></i>
                </div>
                <div>
                    <h3 class="text-2xl font-bold text-gray-900 dark:text-white">Confirm Deletion</h3>
                    <p class="text-sm text-gray-600 dark:text-gray-400">This action cannot be undone.</p>
                </div>
            </div>
        </div>

        <div class="p-8">
            <form method="post" id="deleteForm" class="space-y-6">
                {% csrf_token %}

                <p class="text-lg text-gray-700 dark:text-gray-300 mb-6">
                    Are you sure you want to permanently delete the device:
                    <strong class="font-bold text-red-600 dark:text-red-400">{{ appliance.name }}</strong>?
                </p>

                <div class="flex flex-col sm:flex-row gap-4 pt-6 border-t border-gray-200/50 dark:border-gray-700/50">
                    <a href="{% url 'appliance_list' %}" class="flex-1 px-6 py-4 bg-gray-100 hover:bg-gray-200 dark:bg-gray-800 dark:hover:bg-gray-700 text-gray-800 dark:text-gray-200 font-semibold rounded-xl transition-all duration-200 flex items-center justify-center space-x-2">
                        <i class="fas fa-times"></i>
                        <span>Cancel</span>
                    </a>
                    <button type="submit" class="flex-1 px-6 py-4 bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-700 hover:to-orange-700 text-white font-semibold rounded-xl transition-all duration-200 flex items-center justify-center space-x-2 hover:shadow-lg transform hover:scale-[1.02]">
                        <i class="fas fa-trash"></i>
                        <span>Yes, Delete Permanently</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const deleteForm = document.getElementById('deleteForm');
        if (deleteForm) {
            deleteForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                const submitButton = this.querySelector('button[type="submit"]');
                const originalButtonContent = submitButton.innerHTML;

                submitButton.disabled = true;
                submitButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Deleting...';

                try {
                    const response = await fetch(this.action, {
                        method: 'POST',
                        headers: {
                            'X-Requested-With': 'XMLHttpRequest',
                            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                        },
                        body: new FormData(this)
                    });

                    if (response.ok) {
                        window.location.href = "{% url 'appliance_list' %}?status=success&message=Device deleted successfully!";
                    } else {
                        const errorData = await response.json();
                        // You can display a more specific error message here if needed
                        alert('Error deleting device: ' + (errorData.error || 'An unexpected error occurred.'));
                    }
                } catch (error) {
                    console.error('Fetch error:', error);
                    alert('An unexpected error occurred. Please try again.');
                } finally {
                    submitButton.disabled = false;
                    submitButton.innerHTML = originalButtonContent;
                }
            });
        }
    });
</script>
{% endblock %}